#!/usr/bin/env php
<?php

use Hexlet\Code\PageLoader;
use GuzzleHttp\Client;

$autoloadPath1 = __DIR__ . '/../../../autoload.php';
$autoloadPath2 = __DIR__ . '/../vendor/autoload.php';
if (file_exists($autoloadPath1)) {
    require_once $autoloadPath1;
} else {
    require_once $autoloadPath2;
}

$doc = <<<DOC
Downloads page from URL and save it locally
Usage:
  page-loader (-h|--help)
  page-loader <url> [-o <dir>] 
  page-loader (-v|--version)

Options:
  -h --help                 display help for command
  -v --version              output the version numer
  -o --output <dir>         output dir [default: ./]
DOC;

$args = Docopt::handle($doc, array('version'=>'Page loader 1nn.0'));
$output = $args['--output'];

try {
    $pageLoader = new PageLoader();
    $client = new Client();
    $url = $args['<url>'];
    $path = $pageLoader->downloadPage($url, $output, $client);
    print_r($path);
} catch (\Exception $e) {
    echo $e->getMessage();
}