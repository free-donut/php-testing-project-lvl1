#!/usr/bin/env php
<?php

use Hexlet\Code\PageLoader;
use GuzzleHttp\Client;
use Monolog\Logger;

$autoloadPath1 = __DIR__ . '/../../../autoload.php';
$autoloadPath2 = __DIR__ . '/../vendor/autoload.php';
if (file_exists($autoloadPath1)) {
    require_once $autoloadPath1;
} else {
    require_once $autoloadPath2;
}

$doc = <<<DOC
Downloads page from URL and save it locally
Usage:
  page-loader (-h|--help)
  page-loader <url> [-o <dir>] 
  page-loader (-v|--version)

Options:
  -h --help                 display help for command
  -v --version              output the version numer
  -o --output <dir>         output dir [default: ./]
DOC;

$args = Docopt::handle($doc, array('version'=>'Page loader 1nn.0'));
$output = $args['--output'];
$url = $args['<url>'];
$client = new Client();
$logger = new Logger('LOGGER');

try {
    $pageLoader = new PageLoader($logger);
    $path = $pageLoader->downloadPage($url, $output, $client);
    print_r('Page was successfully downloaded into ');
    print_r($path);
    print_r(PHP_EOL);
} catch (\Exception $e) {
    fwrite(STDERR, 'Выброшено исключение:'.$e->getMessage());
    exit($e->getCode());
    //echo $e->getMessage();
}